#!/usr/bin/env bash
set -eu -o pipefail

ROOT_DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )/.." && pwd )"

reformatted_packages="$(go fmt $(go list github.com/cloudfoundry/bosh-cli/... | grep -v /vendor/))"

if [[ $reformatted_packages = *[![:space:]]* ]]; then
  echo "go fmt reformatted the following packages:"
  echo $reformatted_packages
fi

echo -e "\n Running linter..."
"${ROOT_DIR}/bin/lint"

echo -e "\n Running unit tests..."
"${ROOT_DIR}/bin/ginkgo" -skipPackage="acceptance,integration"

echo -e "\n Building docs example..."
go build -o "${ROOT_DIR}/out/example" github.com/cloudfoundry/bosh-cli/docs/

echo -e "\B Building bosh-cli..."
"${ROOT_DIR}/bin/build"
